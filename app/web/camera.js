import{m as D}from"./media_by_id.js";import{c as v}from"./record.js";import{O as _,b as S,i as I}from"./on.js";import{s as R,e as N,B as V,x as q,o as z}from"./vendor.js";import{_ as A}from"./index.js";var u,k,T;({recbar:k}=I);_.stop=k.stop;T=new Promise(s=>{_.start=s});u="video";var C={setup:()=>{var s;return s=R(),N(async()=>{var n,w,d,j,x,b,e,c,t,B,f,l,m,M,g,O;c=[],B=["audio",u];for(e of B)if(w=localStorage[e],w&&(l=await D[e](w),l&&(e===u&&(s.value.srcObject=l),g=l.getTracks(),c=c.concat(g),!v[e])))for(M of g)M.enabled=!1;return m=new MediaStream(c),t=new MediaRecorder(m,{mimeType:"video/webm;codecs=h264",videoBitsPerSecond:512e3}),_.pause=a=>{var r,o,i,P,h,y,p;for(h=0,p=[],y=m.getTracks(),o=0,P=y.length;o<P;o++)e=y[o],a?r=!1:({kind:i}=e,i===u&&p.push(e),r=!!v[i],r&&(h+=1)),e.enabled=r;if(h===0&&a===!1){if(p.length){v.video=localStorage.video;for(e of p)e.enabled=!0}else S.pause(!0);return}switch(t.state){case"pause":a||t.resume();break;case"recording":a&&t.pause()}},V(()=>{var a,r,o,i;({video:i,audio:a}=v),!i&&!a&&S.pause(!0),r={video:i,audio:a},o=m.getTracks();for(e of o)e.enabled=!!r[e.kind]}),await T,f=new Map,n=+new Date,[O,j]=await E.upload("rec/camera",parseInt(n/1e3)),d=0,t.ondataavailable=({data:a})=>{var r;r=d,d=new Date-n,f.set(d,(async()=>{await O(r,a),f.delete(r)})())},b=void 0,x=new Promise(a=>{b=a}),_.stop=async()=>{t.stop(),await x,await j(),k.stop()},t.onstop=async()=>{await Promise.all(f.values()),b()},t.start(3e3)}),{v:s}}};const F={autoplay:"",ref:"v"};function G(s,n){return z(),q("video",F,null,512)}var U=A(C,[["render",G],["__scopeId","data-v-480e017f"]]);export{U as default};
