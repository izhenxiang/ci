import{N as _}from"./1.js";import{e as N}from"./g.js";import{c as u}from"./.js";import{i as D}from"./2.js";import"./d.js";import"./..js";import"./b.js";import"./-.js";var d,P,f=_(!0);({recbar:d}=D);f.stop=d.cancel;P=new Promise(t=>{f.start=t});var q=async(t,g)=>{var l,s,j,h,p,e,o,m,y;e=new MediaRecorder(t,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:1024e4}),await P,typeof g=="function"&&g(),f.pause=a=>{var i,r,n,v,k,w,b,c;for(w=0,c=[],b=t.getTracks(),n=0,k=b.length;n<k;n++)r=b[n],a?i=!1:({kind:v}=r,v==="video"&&c.push(r),i=!!u[v],i&&(w+=1)),r.enabled=i;if(w===0&&a===!1){if(c.length){u.video=localStorage.video;for(r of c)r.enabled=!0}else broadcast.pause(!0);return}switch(e.state){case"pause":a||e.resume();break;case"recording":a&&e.pause()}},o=new Map,l=+new Date,m=N(parseInt(l/1e3)),[y,j]=await E.upload("rec/"+u.src,m),s=0,e.ondataavailable=({data:a})=>{var i;i=s,s=new Date-l,o.set(s,(async()=>{await y(i,a),o.delete(i)})())},p=void 0,h=new Promise(a=>{p=a}),f.stop=async()=>{e.stop(),d.stop(m),await h,await j(),d.end()},e.onstop=async()=>{await Promise.all(o.values()),p()},e.start(5e3)};export{f as ON,q as default};
