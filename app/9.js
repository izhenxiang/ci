import{N as k}from"./..js";import{c as w}from"./r.js";import{i as P}from"./0.js";import{H as N}from"./e.js";import"./x.js";import"./$.js";import"./h.js";import"./c.js";var d,T,f=k(!0);({recbar:d}=P);f.stop=d.cancel;T=new Promise(o=>{f.start=o});var R=async(o,u)=>{var b,h,l,i,a,t,g;a=new MediaRecorder(o,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:512e4}),await T,typeof u=="function"&&u(),f.pause=e=>{var s,r,n,p,y,m,v,c;for(m=0,c=[],v=o.getTracks(),n=0,y=v.length;n<y;n++)r=v[n],e?s=!1:({kind:p}=r,p==="video"&&c.push(r),s=!!w[p],s&&(m+=1)),r.enabled=s;if(m===0&&e===!1){if(c.length){w.video=localStorage.video;for(r of c)r.enabled=!0}else broadcast.pause(!0);return}switch(a.state){case"pause":e||a.resume();break;case"recording":e&&a.pause()}},t=new Map,[g,b]=await E.upload("rec/"+w.src),i=0,a.ondataavailable=({data:e})=>{t.set(i,(async()=>{await g(i,e),t.delete(i)})()),++i},l=void 0,h=new Promise(e=>{l=e}),f.stop=async()=>{try{a.stop()}catch{}d.stop(),await h,P.open(N+"video/share/"+await b()),d.end()},a.onstop=async()=>{await Promise.all(t.values()),l()},a.start(5e3)};export{f as ON,R as default};
