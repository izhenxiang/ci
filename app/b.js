import{N as T}from"./..js";import{c as w}from"./.js";import{i as y}from"./0.js";import"./a.js";import"./-.js";import"./9.js";import"./$.js";var k="https://testing.izhenxiang.com/",d,P,f=T(!0);({recbar:d}=y);f.stop=d.cancel;P=new Promise(o=>{f.start=o});var H=async(o,u)=>{var b,h,l,i,a,s,g;a=new MediaRecorder(o,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:512e4}),await P,typeof u=="function"&&u(),f.pause=e=>{var t,r,n,p,j,v,m,c;for(v=0,c=[],m=o.getTracks(),n=0,j=m.length;n<j;n++)r=m[n],e?t=!1:({kind:p}=r,p==="video"&&c.push(r),t=!!w[p],t&&(v+=1)),r.enabled=t;if(v===0&&e===!1){if(c.length){w.video=localStorage.video;for(r of c)r.enabled=!0}else broadcast.pause(!0);return}switch(a.state){case"pause":e||a.resume();break;case"recording":e&&a.pause()}},s=new Map,[g,b]=await E.upload("rec/"+w.src),i=0,a.ondataavailable=({data:e})=>{s.set(i,(async()=>{await g(i,e),s.delete(i)})()),++i},l=void 0,h=new Promise(e=>{l=e}),f.stop=async()=>{try{a.stop()}catch{}d.stop(),await h,y.open(k+"video/share/"+await b()),d.end()},a.onstop=async()=>{await Promise.all(s.values()),l()},a.start(5e3)};export{f as ON,H as default};
