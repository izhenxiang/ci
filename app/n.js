import{N as k}from"./0.js";import{c as w}from"./$.js";import{i as T}from"./2.js";import{H as N}from"./d.js";import"./q.js";import"./-.js";import"./g.js";import"./.js";var l,_,c=k(!0);({recbar:l}=T);c.stop=l.cancel;_=new Promise(t=>{c.start=t});var W=async(t,g)=>{var h,b,f,r,a,o,y;a=new MediaRecorder(t,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:512e4}),await _,typeof g=="function"&&g(),c.pause=e=>{var s,i,n,p,P,m,v,u,d;for(m=0,d=[],v=t.getTracks(),n=0,P=v.length;n<P;n++)i=v[n],e?s=!1:({kind:p}=i,p==="video"&&d.push(i),s=!!w[p],s&&(m+=1)),i.enabled=s;if(m===0&&e===!1){if(d.length){w.video=localStorage.video;for(i of d)i.enabled=!0}else broadcast.pause(!0);return}({state:u}=a),u.startsWith("pause")?e||a.resume():u==="recording"&&e&&a.pause()},o=new Map,[y,h]=await E.upload("rec/"+w.src),r=0,a.ondataavailable=({data:e})=>{o.set(r,(async()=>{await y(r,e),o.delete(r)})()),++r},f=void 0,b=new Promise(e=>{f=e}),c.stop=async()=>{try{a.stop()}catch{}l.stop(),await b,await T.open(N+`video_details.html?user_token=${localStorage.uid}&id=`+await h()),await l.end()},a.onstop=async()=>{await Promise.all(o.values()),f()},a.start(5e3)};export{c as ON,W as default};
