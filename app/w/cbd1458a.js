import{m as D}from"./513644be.js";import{c as u}from"./08f73616.js";import{i as I}from"./f055c35d.js";import{O as v,b as S}from"./c73e65f4.js";import{s as R,e as A,A as N,B as V,o as q}from"./9426e368.js";import{_ as z}from"./index.js";var _,j,T;({recbar:j}=I);v.stop=j.stop;T=new Promise(i=>{v.start=i});_="video";var C={setup:()=>{var i;return i=R(),A(async()=>{var n,w,f,k,x,b,e,c,t,B,d,l,m,M,g,O;c=[],B=["audio",_];for(e of B)if(w=localStorage[e],w&&(l=await D[e](w),l&&(e===_&&(i.value.srcObject=l),g=l.getTracks(),c=c.concat(g),!u[e])))for(M of g)M.enabled=!1;return m=new MediaStream(c),t=new MediaRecorder(m,{mimeType:"video/webm;codecs=h264",videoBitsPerSecond:512e3}),v.pause=a=>{var r,o,s,P,h,y,p;for(h=0,p=[],y=m.getTracks(),o=0,P=y.length;o<P;o++)e=y[o],a?r=!1:({kind:s}=e,s===_&&p.push(e),r=!!u[s],r&&(h+=1)),e.enabled=r;if(h===0&&a===!1){if(p.length){u.video=localStorage.video;for(e of p)e.enabled=!0}else S.pause(!0);return}switch(t.state){case"pause":a||t.resume();break;case"recording":a&&t.pause()}},N(()=>{var a,r,o,s;({video:s,audio:a}=u),!s&&!a&&S.pause(!0),r={video:s,audio:a},o=m.getTracks();for(e of o)e.enabled=!!r[e.kind]}),await T,d=new Map,n=+new Date,[O,k]=await E.upload("rec/camera",parseInt(n/1e3)),f=0,t.ondataavailable=({data:a})=>{var r;r=f,f=new Date-n,d.set(f,(async()=>{await O(r,a),d.delete(r)})())},b=void 0,x=new Promise(a=>{b=a}),v.stop=async()=>{t.stop(),await x,await k(),j.stop()},t.onstop=async()=>{await Promise.all(d.values()),b()},t.start(3e3)}),{v:i}}};const F={autoplay:"",ref:"v"};function G(i,n){return q(),V("video",F,null,512)}var W=z(C,[["render",G],["__scopeId","data-v-480e017f"]]);export{W as default};
