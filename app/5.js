import{N as _}from"./-.js";import{e as N}from"./h.js";import{c as u}from"./7.js";import{i as D}from"./..js";import"./2.js";import"./$.js";import"./a.js";import"./.js";var c,P,f=_(!0);({recbar:c}=D);f.stop=c.cancel;P=new Promise(t=>{f.start=t});var q=async(t,g)=>{var l,s,j,h,p,e,o,m,y;e=new MediaRecorder(t,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:1024e4}),await P,typeof g=="function"&&g(),f.pause=a=>{var i,r,n,v,k,w,b,d;for(w=0,d=[],b=t.getTracks(),n=0,k=b.length;n<k;n++)r=b[n],a?i=!1:({kind:v}=r,v==="video"&&d.push(r),i=!!u[v],i&&(w+=1)),r.enabled=i;if(w===0&&a===!1){if(d.length){u.video=localStorage.video;for(r of d)r.enabled=!0}else broadcast.pause(!0);return}switch(e.state){case"pause":a||e.resume();break;case"recording":a&&e.pause()}},o=new Map,l=+new Date,m=N(parseInt(l/1e3)),[y,j]=await E.upload("rec/"+u.src,m),s=0,e.ondataavailable=({data:a})=>{var i;i=s,s=new Date-l,o.set(s,(async()=>{await y(i,a),o.delete(i)})())},p=void 0,h=new Promise(a=>{p=a}),f.stop=async()=>{e.stop(),c.stop(m),await h,await j(),c.end()},e.onstop=async()=>{await Promise.all(o.values()),p()},e.start(5e3)};export{f as ON,q as default};
