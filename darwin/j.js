"use strict";var g=require("electron"),m=require("path"),q=require("fs"),p=require("fs/promises");function z(e=["complete","interactive"]){return new Promise(t=>{e.includes(document.readyState)?t(!0):document.addEventListener("readystatechange",()=>{e.includes(document.readyState)&&t(!0)})})}function R(){var e=document.createElement("div"),t;return e.setAttribute("style",`position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:url('data:image/svg+xml,%0A%3Csvg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"%3E%3Ccircle cx="27.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.8181818181818181s"/%3E%3C/circle%3E%3Ccircle cx="42.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.3636363636363635s"/%3E%3C/circle%3E%3Ccircle cx="57.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.9090909090909091s"/%3E%3C/circle%3E%3Ccircle cx="72.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.45454545454545453s"/%3E%3C/circle%3E%3C/svg%3E') 50% 50% / 96px no-repeat;z-index:9;`),{ing(){t||(t=setTimeout(()=>{t=void 0,document.body.appendChild(e)},500))},xing(){if(t)clearTimeout(t),t=void 0;else try{document.body.removeChild(e)}catch{}}}}var B="https://izhenxiang.com/";var S,j;j=()=>{var e;return e=new Headers,e.append("user_token",localStorage.uid),e};S=class{constructor(t){this.json=this.json.bind(this),this.ipc=t}async fetch(t,r={}){var a;if(r.headers=j(),a=await fetch(B+t+".do",r),a.status===401){delete localStorage.uid,this.ipc.auto_update.relaunch();return}return a}async json(t,r={}){var a;return a=await this.fetch(t,r),a.json()}};var D=e=>new S(e),O=e=>new Promise(t=>setTimeout(t,e)),U=e=>{var t;return t=r=>new Proxy(()=>{},{apply:(a,i,o)=>e(r.join("."),o),get:(a,i)=>t([...r,i])}),t([])},_=U(g.ipcRenderer.invoke),T,P;P=D(_);T=(e,t)=>{var r,a,i,o,d;if(e){r=new FormData,i=Object.entries(e);for(d of i)[a,o]=d,r.append(a,o);return t.body=r,!0}};var H=async(e,t)=>{var r;return r=await v(e,t),(await r.json()).data},v=(e,t)=>{var r;return r={method:"POST"},T(t,r),P.fetch(e,r)};const y="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",E=y.split(""),A=new Array(123);for(let e=0;e<y.length;e++)A[y.charCodeAt(e)]=e;const I=e=>{if(e<0)return`-${ntob(-e)}`;let t=e>>>0,r=e/4294967296>>>0,a="";for(;r>0;)a=E[63&t]+a,t>>>=6,t|=(63&r)<<26,r>>>=6;let i="";do i=E[63&t]+i,t>>>=6;while(t>0);return i+a},L=e=>{let t=0;const r=e.charAt(0)==="-"?1:0;for(let a=r;a<e.length;a++)t=t*64+A[e.charCodeAt(a)];return r?-t:t};var h;h=e=>p.rm(e,{recursive:!0,force:!0});var $=e=>{var t;return t=e(),r=>{var a,i,o,d,b,u,k,f,c;return u=new Set,f=!1,d=i=a=c=void 0,o=new Promise(n=>{d=n}),b=(async()=>{var n,s;c=await H("upload/start"),{uid:s}=localStorage,n=[s,c],a=m.join(await t,"upload",r,...n),n.join("/"),await p.mkdir(a,{recursive:!0})})(),k=async()=>{for(var n,s,l,w,C;u.size;){C=u.values();for(l of C){if(s=m.join(a,l),q.existsSync(s))for(;;){try{if(w=await v("upload/post",{id:c,chunkNum:parseInt(L(l)),file:new File([await p.readFile(s)],"blob")}),w.status!==200)throw new Error(await w.text())}catch(N){n=N,console.trace(n),await O(1e3);continue}await h(s);break}u.delete(l)}}},[async(n,s)=>{var l;await b,n=I(n),l=m.join(a,n),await p.writeFile(l,new DataView(await s.arrayBuffer())),u.add(n),!f&&(f=k().then(()=>{f=!1,i&&d()}))},async()=>(i=!0,await o,await Promise.allSettled([h(a),v("upload/complete",{id:c})]),c),async()=>{await Promise.allSettled([h(a),v("upload/cancel",{id:c})])}]}},F,x,M;({ing:x,xing:M}=R());F=Object.freeze({drag:()=>{},upload:$(_.userData),invoke:(e,t)=>g.ipcRenderer.invoke(e,t),xing:M,ing:x});(()=>{var e,t,r;t={E:F};for(e in t)r=t[e],g.contextBridge.exposeInMainWorld(e,r);z().then(x)})();
