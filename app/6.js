import{N as T}from"./2.js";import{c as w}from"./k.js";import{i as y}from"./3.js";import{H as k}from"./c.js";import"./j.js";import"./1.js";import"./f.js";import"./s.js";var d,P,f=T(!0);({recbar:d}=y);f.stop=d.cancel;P=new Promise(o=>{f.start=o});var R=async(o,b)=>{var u,j,l,i,a,s,h;a=new MediaRecorder(o,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:512e4}),await P,typeof b=="function"&&b(),f.pause=e=>{var t,r,c,p,g,m,v,n;for(m=0,n=[],v=o.getTracks(),c=0,g=v.length;c<g;c++)r=v[c],e?t=!1:({kind:p}=r,p==="video"&&n.push(r),t=!!w[p],t&&(m+=1)),r.enabled=t;if(m===0&&e===!1){if(n.length){w.video=localStorage.video;for(r of n)r.enabled=!0}else broadcast.pause(!0);return}switch(a.state){case"pause":e||a.resume();break;case"recording":e&&a.pause()}},s=new Map,[h,u]=await E.upload("rec/"+w.src),i=0,a.ondataavailable=({data:e})=>{s.set(i,(async()=>{await h(i,e),s.delete(i)})()),++i},l=void 0,j=new Promise(e=>{l=e}),f.stop=async()=>{try{a.stop()}catch{}d.stop(),await j,y.open(k+"video/share/"+await u()),d.end()},a.onstop=async()=>{await Promise.all(s.values()),l()},a.start(5e3)};export{f as ON,R as default};
