"use strict";var m=require("electron"),w=require("path"),P=require("fs"),f=require("fs/promises");function N(e=["complete","interactive"]){return new Promise(t=>{e.includes(document.readyState)?t(!0):document.addEventListener("readystatechange",()=>{e.includes(document.readyState)&&t(!0)})})}function q(){var e=document.createElement("div"),t;return e.setAttribute("style",`position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:url('data:image/svg+xml,%0A%3Csvg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"%3E%3Ccircle cx="27.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.8181818181818181s"/%3E%3C/circle%3E%3Ccircle cx="42.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.3636363636363635s"/%3E%3C/circle%3E%3Ccircle cx="57.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.9090909090909091s"/%3E%3C/circle%3E%3Ccircle cx="72.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.45454545454545453s"/%3E%3C/circle%3E%3C/svg%3E') 50% 50% / 96px no-repeat;z-index:9;`),{appendLoading(){t=setTimeout(()=>{t=void 0,document.body.appendChild(e)},500)},removeLoading(){t?clearTimeout(t):document.body.removeChild(e)}}}var z=e=>new Promise(t=>setTimeout(t,e)),F="https://testing.izhenxiang.com/",C,E,S;C=(e,t)=>fetch(F+e+".do",t);S=(e,t)=>{var r,a,i,s,c;if(e){r=new FormData,i=Object.entries(e);for(c of i)[a,s]=c,r.append(a,s);return t.body=r,!0}};E=()=>{var e;return e=new Headers,e.append("user_token",localStorage.uid),{method:"POST",headers:e}};var R=async(e,t)=>{var r;return r=await h(e,t),(await r.json()).data},h=(e,t)=>{var r;return r=E(),S(t,r),C(e,r)};const g="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",_=g.split(""),T=new Array(123);for(let e=0;e<g.length;e++)T[g.charCodeAt(e)]=e;const B=e=>{if(e<0)return`-${ntob(-e)}`;let t=e>>>0,r=e/4294967296>>>0,a="";for(;r>0;)a=_[63&t]+a,t>>>=6,t|=(63&r)<<26,r>>>=6;let i="";do i=_[63&t]+i,t>>>=6;while(t>0);return i+a},D=e=>{let t=0;const r=e.charAt(0)==="-"?1:0;for(let a=r;a<e.length;a++)t=t*64+T[e.charCodeAt(a)];return r?-t:t};var y;y=e=>f.rm(e,{recursive:!0,force:!0});var O=e=>{var t;return t=e(),r=>{var a,i,s,c,x,u,b,p,d;return u=new Set,p=!1,c=i=a=d=void 0,s=new Promise(n=>{c=n}),x=(async()=>{var n,o;d=await R("upload/start"),{uid:o}=localStorage,n=[o,d],a=w.join(await t,"upload",r,...n),n.join("/"),await f.mkdir(a,{recursive:!0})})(),b=async()=>{for(var n,o,l,v,k;u.size;){k=u.values();for(l of k){if(o=w.join(a,l),P.existsSync(o))for(;;){try{if(v=await h("upload/post",{id:d,chunkNum:parseInt(D(l)),file:new File([await f.readFile(o)],"blob")}),v.status!==200)throw new Error(await v.text())}catch(L){n=L,console.trace(n),await z(1e3);continue}await y(o);break}u.delete(l)}}},[async(n,o)=>{var l;await x,n=B(n),l=w.join(a,n),await f.writeFile(l,new DataView(await o.arrayBuffer())),u.add(n),!p&&(p=b().then(()=>{p=!1,i&&c()}))},async()=>(i=!0,await s,await y(a),await h("upload/complete",{id:d}),d)]}},H=e=>{var t;return t=r=>new Proxy(()=>{},{apply:(a,i,s)=>e(r.join("."),s),get:(a,i)=>t([...r,i])}),t([])},I=H(m.ipcRenderer.invoke),j,A,M;j=Object.freeze({drag:()=>{},upload:O(I.userData),loaded:()=>{M()},invoke:(e,t)=>m.ipcRenderer.invoke(e,t)});({removeLoading:M,appendLoading:A}=q());(()=>{var e,t,r;t={E:j};for(e in t)r=t[e],m.contextBridge.exposeInMainWorld(e,r);N().then(A)})();
