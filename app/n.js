"use strict";var m=require("electron"),w=require("path"),L=require("fs"),f=require("fs/promises");function q(e=["complete","interactive"]){return new Promise(t=>{e.includes(document.readyState)?t(!0):document.addEventListener("readystatechange",()=>{e.includes(document.readyState)&&t(!0)})})}function z(){var e=document.createElement("div"),t;return e.setAttribute("style",`position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:url('data:image/svg+xml,%0A%3Csvg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"%3E%3Ccircle cx="27.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.8181818181818181s"/%3E%3C/circle%3E%3Ccircle cx="42.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-1.3636363636363635s"/%3E%3C/circle%3E%3Ccircle cx="57.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.9090909090909091s"/%3E%3C/circle%3E%3Ccircle cx="72.5" cy="57.5" r="5" fill="%23fd9e4b"%3E%3Canimate attributeName="cy" calcMode="spline" keySplines="0 0.5 0.5 1;0.5 0 1 0.5;0.5 0.5 0.5 0.5" repeatCount="indefinite" values="57.5;42.5;57.5;57.5" keyTimes="0;0.3;0.6;1" dur="3.0303030303030303s" begin="-.45454545454545453s"/%3E%3C/circle%3E%3C/svg%3E') 50% 50% / 96px no-repeat;z-index:9;`),{appendLoading(){t=setTimeout(()=>{t=void 0,document.body.appendChild(e)},500)},removeLoading(){t?clearTimeout(t):document.body.removeChild(e)}}}var N=e=>new Promise(t=>setTimeout(t,e)),F="https://testing.izhenxiang.com/",C,E,S;C=(e,t)=>fetch(F+e+".do",t);S=(e,t)=>{var r,i,a,s,d;if(e){r=new FormData,a=Object.entries(e);for(d of a)[i,s]=d,r.append(i,s);return t.body=r,!0}};E=()=>{var e;return e=new Headers,e.append("user_token",localStorage.uid),{method:"POST",headers:e}};var R=async(e,t)=>{var r;return r=await h(e,t),(await r.json()).data},h=(e,t)=>{var r;return r=E(),S(t,r),C(e,r)};const y="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",_=y.split(""),j=new Array(123);for(let e=0;e<y.length;e++)j[y.charCodeAt(e)]=e;const B=e=>{if(e<0)return`-${ntob(-e)}`;let t=e>>>0,r=e/4294967296>>>0,i="";for(;r>0;)i=_[63&t]+i,t>>>=6,t|=(63&r)<<26,r>>>=6;let a="";do a=_[63&t]+a,t>>>=6;while(t>0);return a+i},D=e=>{let t=0;const r=e.charAt(0)==="-"?1:0;for(let i=r;i<e.length;i++)t=t*64+j[e.charCodeAt(i)];return r?-t:t};var g;g=e=>f.rm(e,{recursive:!0,force:!0});var O=e=>{var t;return t=e(),r=>{var i,a,s,d,x,u,b,p,l;return u=new Set,p=!1,d=a=i=l=void 0,s=new Promise(n=>{d=n}),x=(async()=>{var n,o;l=await R("upload/start"),{uid:o}=localStorage,n=[o,l],i=w.join(await t,"upload",r,...n),n.join("/"),await f.mkdir(i,{recursive:!0})})(),b=async()=>{for(var n,o,c,v,k;u.size;){k=u.values();for(c of k){if(o=w.join(i,c),L.existsSync(o))for(;;){try{if(v=await h("upload/post",{id:l,chunkNum:parseInt(D(c)),file:new File([await f.readFile(o)],"blob")}),v.status!==200)throw new Error(await v.text())}catch(P){n=P,console.trace(n),await N(1e3);continue}await g(o);break}u.delete(c)}}},[async(n,o)=>{var c;await x,n=B(n),c=w.join(i,n),await f.writeFile(c,new DataView(await o.arrayBuffer())),u.add(n),!p&&(p=b().then(()=>{p=!1,a&&d()}))},async()=>(a=!0,await s,await g(i),await h("upload/complete",{id:l}),l)]}},H=e=>{var t;return t=r=>new Proxy(()=>{},{apply:(i,a,s)=>e(r.join("."),s),get:(i,a)=>t([...r,a])}),t([])},I=H(m.ipcRenderer.invoke),T,A,M;(async()=>{var e;e=await Promise.resolve().then(function(){return require("./u.js")}),e.init({dsn:"http://87efcd705ef746db873a87c5721c9336@sentry.izhenxiang.com/4"})})();T=Object.freeze({drag:()=>{},upload:O(I.userData),loaded:()=>{M()},invoke:(e,t)=>m.ipcRenderer.invoke(e,t)});({removeLoading:M,appendLoading:A}=z());(()=>{var e,t,r;t={E:T};for(e in t)r=t[e],m.contextBridge.exposeInMainWorld(e,r);q().then(A)})();
